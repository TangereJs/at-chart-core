<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../at-chart-core/c3-import.html">

<polymer-element name="at-chart-core">
    <template>      
        <link rel="stylesheet" href="../c3/c3.css">
          <style>
           :host {
             position: relative;
             box-sizing: border-box;
             display: block;
             width:100%;
           }
        </style>
        <div style="border:4px solid transparent;">
           <div id="chart">
        </div>
    </template>

    <script>
        Polymer('at-chart-core', { 
            publish: {
              charttype: { value: 'line', reflect: true },
              gridlines: { value: 'none', reflect: true },
              legendposition: { value: 'none', reflect: true },
              tooltip: { value: 'none', reflect: true },
              c3chart: {},
              data: {}
            },
          
            observe: {
              'charttype c3chart data gridlines legendposition tooltip': 'initialize'
            },
          
            initialize: function() {
                var chart = {};
                chart.data = {};              
                Platform.mixin(chart,this.c3chart);              
                
                if(this.charttype != 'default') { chart.data.type = this.charttype; }
              
                if(this.gridlines != "none" && this.gridlines != "") {
                  chart.grid = {};
                  
                  if(this.gridlines=="x" || this.gridlines == "xy") {
                    chart.grid.x = { show: true };
                  }
                  
                 if(this.gridlines=="y" || this.gridlines == "xy") {
                    chart.grid.y = { show: true };
                  }

                }
              
                if(this.legendposition != "") {
                  chart.legend = {};
                  
                  if(this.legendposition != "none") {
                    chart.legend = { position: this.legendposition };
                  } else {
                    chart.legend = { show: false };
                  }            

                }
              
                if(this.tooltip != "") {
                  chart.tooltip = {grouped: true, show: true};                                   
                  
                  if(this.tooltip == "default") {
                    chart.tooltip = { grouped: false };
                  } 
                  if(this.tooltip == "none") {
                    chart.tooltip = { show: false };
                  }            

                }
              
                chart.bindto = this.$.chart;

                this._chartContainer = c3.generate(chart);
              
                this.async(function() {
                  this._chartContainer.resize();
                 }, null, 100);
            },
            
			domReady: function() {
		 
				// exit if parent component is not running directly in designer
				//if(!this.parentNode.id || !this.parentNode.id=="design_host") return;
				
				// get sample data 
				var txt = this.innerHTML.trim();
				if(!txt) return;
				
				var json = null;
				
				try {
					json = JSON.parse(txt);
				}
				catch(err) {		
					var msg = document.createElement("div");
					msg.innerHTML = "<br>Error: " + err.message + "<br>";
					this.shadowRoot.appendChild(msg);
				}

				if(json != null) {
					this.c3chart = json;
				}            
				this.initialize();
			},
            ready: function () {
				
			}
        });

    </script>
</polymer-element>
