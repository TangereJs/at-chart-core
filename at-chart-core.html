<link rel="import" href="../tangere/tangere.html">
<link rel="import" href="../at-theme/at-theme.html">
<link rel="import" href="at-chart-core-lib.html">

<dom-module id="at-chart-core">
  <style>
    :host {
      position: relative;
      box-sizing: border-box;
      display: block;
      width: 100%;
    }

    .canvasSize {
      max-height:100% !important;
        max-width:100% !important;
    }

  </style>
    <template>
      <div style="border:4px solid transparent;">
        <canvas class="canvasSize" id="chart"></canvas>
      </div>
    </template>
</dom-module>

<script>
  Polymer({
    is: 'at-chart-core',
    properties: {
      model: {
        type: Object,
        xtype: "code",
        mode: "json",
        xgridcols: '12'
      },
    },

    modelRoot: {
      type: String,
      value: "state.chart"
    },

    $meta: [{
      type: "element",
      xtype: "at-chart-core",
      title: "Charts",
      icon: "now:chart"
    }],
    observers: [
      'modelChanged(model)'
    ],

    modelChanged: function (model) {

      var definition;

      if (Object.prototype.toString.call(model) === "[object String]") {
        parsedModel = JSON.parse(model);
        definition = parsedModel.chart;
      }

      if (Object.prototype.toString.call(model) !== "[object String]") {
        definition = model;
      }

      if (definition && definition.configuration && definition.configuration.options) {

        // hide title as card has title element
        if (definition.configuration.options.title) {
          definition.configuration.options.title.display = false;
        }
      }

      this._initialize(definition);
    },

    _initialize: function (definition) {
      var self = this;
      var def = definition;
      var canvas = self.$.chart;

      createChart(canvas, def);
    },

    actionListener: function (event) {

      this.model = event.detail.model.state.model.chart;
    },

    ready: function () {

    },
  });
</script>

